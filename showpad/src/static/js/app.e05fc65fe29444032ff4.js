webpackJsonp([1],{0:function(e,t){},1:function(e,t){},E83e:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("7+uW"),i=n("BO1k"),a=n.n(i),s=n("Xxa5"),o=n.n(s),c=n("exGp"),l=n.n(c),u=n("//Fk"),d=n.n(u),p=n("4PV6"),h=n.n(p);var f={waitForShowpadLib:function(){return new d.a(function(e,t){if(window.ShowpadLib)e();else{var n=setTimeout(function(){t(new Error("ShowpadLib timed out."))},2e3);window.onShowpadLibLoaded=function(){clearTimeout(n),e()}}})},getConfigJson:function(){return new d.a(function(e,t){var n=decodeURIComponent(window.frameElement.src.split("configUrl=")[1]).split("&")[0];h()(n).then(function(e){return e.json()}).then(e).catch(t)})},getAssetsByTags:function(e){return new d.a(function(t,n){window.ShowpadLib.getAssetsByTags(e,function(e){e?t(e):n(new Error("Something went wrong while fetching assets by tag."))})||n(new Error("Something went wrong while fetching assets by tag."))})},getThumbnailImage:function(e,t){return window.ShowpadLib.getAssetPreviewUrl(e.id,e.slug,t||1e3)},saveLocally:function(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";var r=window.URL.createObjectURL(e);n.href=r,n.download=t,n.click(),window.URL.revokeObjectURL(r)},saveToMyFiles:function(e,t){return new d.a(function(n,r){var i={file:e,filename:t},a=window.ShowpadLib.upload(i);a.on("success",function(e){n(e.asset.id)}),a.on("failed",function(e){r(e)})})},getApiConfig:function(){return new d.a(function(e,t){var n=setTimeout(function(){t(new Error("Showpad API config timed out"))},5e3);window.ShowpadLib.getShowpadApi(function(r){null===r.error?(window.clearTimeout(n),e(r)):t(r.error)})})},getAssetById:function(e,t){return new d.a(function(n,r){h()(t.url+"/api/v3/assets/"+e+".json",{method:"GET",withCredentials:!0,credentials:"include",headers:{Authorization:"Bearer "+t.accessToken}}).then(function(e){return console.log(e),e.json()}).then(n).catch(r)})}},v=n("Zrlr"),m=n.n(v),w=n("wxAW"),g=n.n(w),b=n("WgY6"),x=n.n(b),_=/{{\s*([a-zA-Z0-9]+\s*[a-zA-Z0-9]+)\s*}}/g,y={Templater:function(){function e(){m()(this,e),this.archive=void 0,this.type=void 0,this.vars=[]}return g()(e,[{key:"parse",value:function(){var e=l()(o.a.mark(function e(t){var n,r,i,s,c,l,u,d,p,h,f,v,m,w,g,b,y,k,E,C,L,T;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.loadAsync(t);case 2:if(this.archive=e.sent,n=this.archive.file(/word\/document.xml/),r=this.archive.file(/slides\/slide\d\.xml/),!(n.length>0)){e.next=32;break}return this.type="docx",console.log("Identified .DOCX"),e.next=10,n[0].async("string");case 10:for(i=e.sent,s=!0,c=!1,l=void 0,e.prev=14,u=a()(i.matchAll(_));!(s=(d=u.next()).done);s=!0)p=d.value,this.vars.push(p[1]);e.next=22;break;case 18:e.prev=18,e.t0=e.catch(14),c=!0,l=e.t0;case 22:e.prev=22,e.prev=23,!s&&u.return&&u.return();case 25:if(e.prev=25,!c){e.next=28;break}throw l;case 28:return e.finish(25);case 29:return e.finish(22);case 30:e.next=84;break;case 32:if(!(r.length>0)){e.next=83;break}console.log("Identified .PPTX"),this.type="pptx",h=!0,f=!1,v=void 0,e.prev=38,m=a()(r);case 40:if(h=(w=m.next()).done){e.next=67;break}return g=w.value,e.next=44,g.async("string");case 44:for(b=e.sent,y=!0,k=!1,E=void 0,e.prev=48,C=a()(b.matchAll(_));!(y=(L=C.next()).done);y=!0)T=L.value,this.vars.push(T[1]);e.next=56;break;case 52:e.prev=52,e.t1=e.catch(48),k=!0,E=e.t1;case 56:e.prev=56,e.prev=57,!y&&C.return&&C.return();case 59:if(e.prev=59,!k){e.next=62;break}throw E;case 62:return e.finish(59);case 63:return e.finish(56);case 64:h=!0,e.next=40;break;case 67:e.next=73;break;case 69:e.prev=69,e.t2=e.catch(38),f=!0,v=e.t2;case 73:e.prev=73,e.prev=74,!h&&m.return&&m.return();case 76:if(e.prev=76,!f){e.next=79;break}throw v;case 79:return e.finish(76);case 80:return e.finish(73);case 81:e.next=84;break;case 83:throw new Error("Failed to identify file as .docx or .pptx");case 84:return e.abrupt("return",this.vars);case 85:case"end":return e.stop()}},e,this,[[14,18,22,30],[23,,25,29],[38,69,73,81],[48,52,56,64],[57,,59,63],[74,,76,80]])}));return function(t){return e.apply(this,arguments)}}()},{key:"replace",value:function(){var e=l()(o.a.mark(function e(t,n){var r,i,s,c,l,u,d,p,h,f;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("docx"!==this.type){e.next=8;break}return e.next=3,this.archive.file(/word\/document.xml/)[0].async("string");case 3:r=e.sent,i=r.replace(_,function(e,n){return t[n]?t[n]:""}),this.archive.file(this.archive.file(/word\/document.xml/)[0].name,i),e.next=38;break;case 8:if("pptx"!==this.type){e.next=38;break}s=!0,c=!1,l=void 0,e.prev=12,u=a()(this.archive.file(/slides\/slide\d\.xml/));case 14:if(s=(d=u.next()).done){e.next=24;break}return p=d.value,e.next=18,p.async("string");case 18:h=e.sent,f=h.replace(_,function(e,n){return t[n]?t[n]:""}),this.archive.file(p.name,f);case 21:s=!0,e.next=14;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(12),c=!0,l=e.t0;case 30:e.prev=30,e.prev=31,!s&&u.return&&u.return();case 33:if(e.prev=33,!c){e.next=36;break}throw l;case 36:return e.finish(33);case 37:return e.finish(30);case 38:return e.abrupt("return",this.archive.generateAsync({type:n||"blob"}));case 39:case"end":return e.stop()}},e,this,[[12,26,30,38],[31,,33,37]])}));return function(t,n){return e.apply(this,arguments)}}()}]),e}()},k=(n("/Luh"),{name:"SlideshowTemplater",mounted:function(){var e=this;l()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.waitForShowpadLib();case 2:return t.next=4,f.getConfigJson();case 4:e.templates=t.sent.assets,console.log(e.templates);case 6:case"end":return t.stop()}},t,e)}))(),this.mode="begin"},data:function(){return{mode:"init",templates:[],selected:void 0,templater:void 0,vars:void 0,inputError:void 0,finalMap:void 0,blob:void 0,name:""}},methods:{getThumbnailImage:function(e){return f.getThumbnailImage(e)},select:function(e){var t=this;this.selected=e,console.log("Selected template ",this.selected.name),this.mode="template",this.templater=new y.Templater,l()(o.a.mark(function e(){var n,r,i,a,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.t1=t.selected.id,e.next=4,f.getApiConfig();case 4:return e.t2=e.sent,e.next=7,e.t0.getAssetById.call(e.t0,e.t1,e.t2);case 7:return n=e.sent,console.log(n),r=n.response,i=r.shortLivedDownloadLink,console.log(i),e.next=14,fetch(i);case 14:return e.next=16,e.sent.blob();case 16:return a=e.sent,e.next=19,t.templater.parse(a);case 19:s=e.sent,t.vars=s;case 21:case"end":return e.stop()}},e,t)}))()},reset:function(){this.selected=void 0,this.templater=void 0,this.vars=void 0,this.inputError=void 0,this.finalMap=void 0,this.blob=void 0,this.name="",this.mode="begin"},generate:function(){var e=this,t=document.getElementsByClassName("form_field"),n=!0,r=!1,i=void 0;try{for(var s,c=a()(t);!(n=(s=c.next()).done);n=!0){var u=s.value,d=u.children[0].firstChild.innerText;if(""==(g=u.children[1].firstChild.value))return void(this.inputError="Please fill all of the boxes.")}}catch(e){r=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(r)throw i}}this.inputError=void 0,this.finalMap={};var p=!0,h=!1,f=void 0;try{for(var v,m=a()(t);!(p=(v=m.next()).done);p=!0){var w=v.value,g=(d=w.children[0].firstChild.innerText,w.children[1].firstChild.value);this.finalMap[d]=g}}catch(e){h=!0,f=e}finally{try{!p&&m.return&&m.return()}finally{if(h)throw f}}console.log(this.finalMap),l()(o.a.mark(function t(){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.templater.replace(e.finalMap);case 2:e.blob=t.sent,n=new Date,r=n.getFullYear().toString()+"_"+n.getMonth().toString()+"_"+n.getDay().toString()+"_",e.name=r+e.selected.name,e.mode="confirm";case 7:case"end":return t.stop()}},t,e)}))()},downloadBlob:function(){this.name.length<1?this.inputError="Please provide a filename.":this.name.toLowerCase().endsWith(".docx")||this.name.toLowerCase().endsWith(".pptx")?(this.inputError="",f.saveLocally(this.blob,this.name)):this.inputError="Please include a file extension."},myFilesBlob:function(){this.name.length<1?this.inputError="Please provide a filename.":this.name.toLowerCase().endsWith(".docx")||this.name.toLowerCase().endsWith(".pptx")?(this.inputError="",f.saveToMyFiles(this.blob,this.name)):this.inputError="Please include a file extension."}}}),E={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"wrapper"}},[n("transition",{attrs:{name:"slide-fade"}},["begin"==e.mode?n("div",[n("h1",[e._v("Select a template:")]),e._v(" "),0==e.templates.length?n("span",[e._v("Loading templates...")]):e._e(),e._v(" "),n("div",{attrs:{id:"template_container"}},[n("transition-group",{attrs:{name:"slide-fade",tag:"div"}},e._l(e.templates,function(t){return n("fieldset",{key:t.id,staticClass:"template",on:{click:function(n){return e.select(t)}}},[n("legend",{staticClass:"t_name"},[e._v(e._s(t.name))]),e._v(" "),n("div",[n("img",{staticClass:"t_image",attrs:{src:e.getThumbnailImage(t)}})])])}),0)],1)]):e._e()]),e._v(" "),n("transition",{attrs:{name:"slide-fade"}},["template"==e.mode?n("div",[n("h1",[e._v("Specify Substitutions:")]),e._v(" "),e.vars?e._e():n("span",[e._v("Processing template...")]),e._v(" "),n("table",[n("transition-group",{attrs:{name:"slide-fade-side",tag:"div"}},e._l(e.vars,function(t){return n("tr",{key:t,staticClass:"form_field"},[n("td",[n("label",[e._v(e._s(t))])]),e._v(" "),n("td",[n("input",{attrs:{type:"text"}})])])}),0)],1),e._v(" "),n("transition",{attrs:{name:"slide-fade-side"}},[e.inputError?n("div",{attrs:{id:"inputError"}},[e._v(e._s(e.inputError))]):e._e()]),e._v(" "),n("div",{staticClass:"button_container"},[n("button",{on:{click:function(t){return e.reset()}}},[e._v("Cancel")]),e._v(" "),n("button",{staticClass:"ok_b",on:{click:function(t){return e.generate()}}},[e._v("Generate Document")])])],1):e._e()]),e._v(" "),n("transition",{attrs:{name:"slide-fade"}},["confirm"==e.mode?n("div",[n("h1",[e._v("Download:")]),e._v(" "),n("label",[e._v("Filename:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],attrs:{type:"text"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),e._v(" "),n("transition",{attrs:{name:"slide-fade-side"}},[e.inputError?n("div",{attrs:{id:"inputError"}},[e._v(e._s(e.inputError))]):e._e()]),e._v(" "),n("div",{staticClass:"button_container"},[n("button",{staticClass:"ok_b finalb",on:{click:function(t){return e.downloadBlob()}}},[e._v("Download")]),e._v(" "),n("button",{staticClass:"ok_b_b finalb",on:{click:function(t){return e.myFilesBlob()}}},[e._v("Upload to My Files")])]),e._v(" "),n("button",{staticClass:"finalb",on:{click:function(t){return e.reset()}}},[e._v("Return to Templates")])],1):e._e()])],1)},staticRenderFns:[]};var C={name:"App",components:{SlideshowTemplater:n("VU/8")(k,E,!1,function(e){n("E83e")},"data-v-3de4d1a4",null).exports}},L={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("SlideshowTemplater")],1)},staticRenderFns:[]};var T=n("VU/8")(C,L,!1,function(e){n("PgqK")},null,null).exports;r.a.config.productionTip=!1,new r.a({el:"#app",components:{App:T},template:"<App/>"})},PgqK:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.e05fc65fe29444032ff4.js.map